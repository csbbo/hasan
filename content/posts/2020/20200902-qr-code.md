---
title: "Go生成二维码"
date: 2020-09-02T10:38:09+08:00
categories: ["Golang"]
toc: true
---

使用Go语言编程生成二维码特别方便， 这里使用生成二维码的库是`go-qrcode`，废话不多说开整

<!--more-->

生成一张256*256大小的二维码图片

```go
package main

import (
	"github.com/skip2/go-qrcode"
)

func main() {
	qrcode.WriteFile("https://blog.shaobo.fun/", qrcode.Highest, 256, "blog.png")
}
```

WriteFile函数的原型定义如下:
```go
func WriteFile(content string, level RecoveryLevel, size int, filename string) error
```
1. content表示要生成二维码的内容，可以是任意字符串。
2. level表示二维码的容错级别，取值有Low、Medium、High、Highest。
3. size表示生成图片的width和height，像素单位。
4. filename表示生成的文件名路径。

### 自定义前景色背景色

```go
package main

import (
	"github.com/skip2/go-qrcode"
	"log"
	"image/color"
)

func main() {
	qr, err := qrcode.New("https://blog.shaobo.fun/", qrcode.Highest)
	if err != nil {
		log.Fatal(err)
	} else {
		// qr.DisableBorder = true
		qr.BackgroundColor = color.RGBA{147, 105, 96, 255}
		qr.ForegroundColor = color.White
		qr.WriteFile(256, "blog.png")
	}
}
```

> 使用的调色板地址[https://www.sojson.com/web/panel.html](https://www.sojson.com/web/panel.html)

### 生成带头像的二维码

```go
package main

import (
	"github.com/nfnt/resize"
	"github.com/skip2/go-qrcode"
	"image"
	"image/color"
	"image/draw"
	"image/jpeg"
	"image/png"
	"os"
	"path"
)

func main() {
	qrImg, err := createQrImg("https://blog.shaobo.fun/")
	if err != nil {
		panic(err)
	}
	avatarImg, err := getAvatarImg("./avatar.jpeg", 50, 50)
	if err != nil {
		panic(err)
	}
	qrImgBound := qrImg.Bounds()
	avatarImgBound := avatarImg.Bounds()
	x := (qrImgBound.Max.X - avatarImgBound.Max.X) / 2
	y := (qrImgBound.Max.Y - avatarImgBound.Max.Y) / 2
	offset := image.Pt(x, y)

	img := image.NewRGBA(qrImgBound)
	draw.Draw(img, qrImgBound, qrImg, image.Point{X: 0, Y: 0}, draw.Src)
	draw.Draw(img, avatarImgBound.Add(offset), avatarImg, image.Point{X: 0, Y: 0}, draw.Over)

	i, _ := os.Create(path.Base("blog.png"))
	_ = png.Encode(i, img)
	defer i.Close()
}

func createQrImg(content string) (img image.Image, err error) {
	var qr *qrcode.QRCode
	qr, err = qrcode.New(content, qrcode.Highest)
	if err != nil {
		return nil, err
	}
	qr.DisableBorder = false
	qr.BackgroundColor = color.RGBA{147, 105, 96, 255}
	qr.ForegroundColor = color.White
	img = qr.Image(256)
	return img, err
}

func getAvatarImg(path string, w int, h int) (img image.Image, err error) {
	file, err := os.Open(path)
	if err != nil {
		return nil, err
	}
	img, err = jpeg.Decode(file)
	if err != nil {
		return nil, err
	}
	img = resize.Resize(uint(w), uint(h), img, resize.Lanczos3)
	return img, err
}
```
<img src="/assets/2020/0902/blog.png" style="width:25%"/>
<span style="margin-left: 43%; color: gray;">带头像的二维码</span>